<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sarah Hagen">

<title>FNA Process: Working with the tabular data ‚Äì LANDFIRE in Fire Needs Assessments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e980fa6a33e6e6d4c3299ce5f86029ea.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-2c63ab2e9bc0ec9a869a30abd6a1ca7e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-e980fa6a33e6e6d4c3299ce5f86029ea.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">LANDFIRE in Fire Needs Assessments</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">An Overview of Fire Needs Assessments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../ArcGIS/historical-vegetation.html"> 
<span class="menu-text">Fire Needs Assessments in ArcGIS Pro</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../r-workflow/r-introduction.html"> 
<span class="menu-text">Fire Needs Assessments in R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../python-workflow/python-introduction.html"> 
<span class="menu-text">Fire Needs Assessments in Python</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#working-with-the-csv-file-in-microsoft-excel" id="toc-working-with-the-csv-file-in-microsoft-excel" class="nav-link active" data-scroll-target="#working-with-the-csv-file-in-microsoft-excel">Working with the CSV File in Microsoft Excel</a>
  <ul class="collapse">
  <li><a href="#step-by-step-process" id="toc-step-by-step-process" class="nav-link" data-scroll-target="#step-by-step-process">Step-by-Step Process</a></li>
  </ul></li>
  <li><a href="#calculating-evt-acres-in-microsoft-excel" id="toc-calculating-evt-acres-in-microsoft-excel" class="nav-link" data-scroll-target="#calculating-evt-acres-in-microsoft-excel">Calculating EVT Acres in Microsoft Excel</a>
  <ul class="collapse">
  <li><a href="#step-by-step-process-1" id="toc-step-by-step-process-1" class="nav-link" data-scroll-target="#step-by-step-process-1">Step-by-Step Process</a></li>
  <li><a href="#screenshot-for-calculating-evt-acres" id="toc-screenshot-for-calculating-evt-acres" class="nav-link" data-scroll-target="#screenshot-for-calculating-evt-acres">Screenshot for calculating EVT acres</a></li>
  </ul></li>
  <li><a href="#creating-a-pivot-table-in-microsoft-excel" id="toc-creating-a-pivot-table-in-microsoft-excel" class="nav-link" data-scroll-target="#creating-a-pivot-table-in-microsoft-excel">Creating a Pivot Table in Microsoft Excel</a>
  <ul class="collapse">
  <li><a href="#why-use-pivot-tables" id="toc-why-use-pivot-tables" class="nav-link" data-scroll-target="#why-use-pivot-tables">Why Use Pivot Tables?</a></li>
  <li><a href="#step-by-step-process-2" id="toc-step-by-step-process-2" class="nav-link" data-scroll-target="#step-by-step-process-2">Step-by-step process</a></li>
  <li><a href="#screenshots-for-creating-the-pivot-table" id="toc-screenshots-for-creating-the-pivot-table" class="nav-link" data-scroll-target="#screenshots-for-creating-the-pivot-table">Screenshots for creating the pivot table</a></li>
  </ul></li>
  <li><a href="#creating-the-weighted-average-fire-return-interval" id="toc-creating-the-weighted-average-fire-return-interval" class="nav-link" data-scroll-target="#creating-the-weighted-average-fire-return-interval">Creating the weighted average fire return interval</a>
  <ul class="collapse">
  <li><a href="#step-by-step-process-3" id="toc-step-by-step-process-3" class="nav-link" data-scroll-target="#step-by-step-process-3">Step-by-step process</a></li>
  </ul></li>
  <li><a href="#creating-a-summary-table-in-microsoft-excel" id="toc-creating-a-summary-table-in-microsoft-excel" class="nav-link" data-scroll-target="#creating-a-summary-table-in-microsoft-excel">Creating a Summary Table in Microsoft Excel</a>
  <ul class="collapse">
  <li><a href="#step-by-step-process-4" id="toc-step-by-step-process-4" class="nav-link" data-scroll-target="#step-by-step-process-4">Step-by-Step Process</a></li>
  </ul></li>
  <li><a href="#saving-the-worksheet-back-to-a-.csv-file" id="toc-saving-the-worksheet-back-to-a-.csv-file" class="nav-link" data-scroll-target="#saving-the-worksheet-back-to-a-.csv-file">Saving the worksheet back to a .csv file</a>
  <ul class="collapse">
  <li><a href="#step-by-step-process-5" id="toc-step-by-step-process-5" class="nav-link" data-scroll-target="#step-by-step-process-5">Step-by-step process</a></li>
  </ul></li>
  <li><a href="#bringing-your-csv-file-back-into-arcgis-pro" id="toc-bringing-your-csv-file-back-into-arcgis-pro" class="nav-link" data-scroll-target="#bringing-your-csv-file-back-into-arcgis-pro">Bringing your CSV file back into ArcGIS Pro</a>
  <ul class="collapse">
  <li><a href="#step-by-step-process-6" id="toc-step-by-step-process-6" class="nav-link" data-scroll-target="#step-by-step-process-6">Step-by-step process</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">FNA Process: Working with the tabular data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sarah Hagen </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="working-with-the-csv-file-in-microsoft-excel" class="level2">
<h2 class="anchored" data-anchor-id="working-with-the-csv-file-in-microsoft-excel">Working with the CSV File in Microsoft Excel</h2>
<p>Once you have exported your attribute table to CSV format, you can open it in Microsoft Excel or your spreadsheet program of choice. This tutorial will focus on Microsoft Excel, so instructions may differ in other programs.</p>
<section id="step-by-step-process" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process">Step-by-Step Process</h3>
<p>This process will help you focus on the most relevant data for your analysis while retaining the original CSV format for future use if needed.</p>
<ol type="1">
<li><strong>Open the CSV file</strong>
<ul>
<li>Open the CSV file in Microsoft Excel. You will see an exact copy of the attribute table you just exported from ArcGIS Pro.</li>
</ul></li>
<li><strong>Save a copy as an Excel workbook</strong>
<ul>
<li>Before modifying the table, save a copy of it as an Excel workbook (.xlsx). Many changes to the table in the remainder of this process will be incompatible with the CSV format. To ensure you don‚Äôt lose any data you may need in future analyses, it‚Äôs best to keep the CSV in-tact and make changes in a working copy.</li>
</ul></li>
<li><strong>Identify key fields</strong>
<ul>
<li>The most relevant fields to this analysis are:
<ul>
<li><strong>EVT_NAME</strong></li>
<li><strong>BPS_NAME</strong></li>
<li><strong>FRI_ALLFIR</strong></li>
<li><strong>Acres</strong></li>
<li><strong>Acres_Year</strong></li>
</ul></li>
</ul></li>
<li><strong>Delete unnecessary fields</strong>
<ul>
<li>Once you‚Äôve made a copy of the CSV data, you can delete any fields you don‚Äôt need. In all cases, you can safely delete any fields associated with the colormap, such as <strong>R</strong>, <strong>G</strong>, <strong>B</strong>, <strong>RED</strong>, <strong>GREEN</strong>, <strong>BLUE</strong> as well as the value fields for your BPS_Vegetated and EVT_Vegetated rasters (the ones you used to join fields to the combined raster attribute table.)</li>
</ul></li>
</ol>
<p>This process will help you focus on the most relevant data for your analysis while retaining the original CSV data for future use if needed.</p>
</section>
</section>
<section id="calculating-evt-acres-in-microsoft-excel" class="level2">
<h2 class="anchored" data-anchor-id="calculating-evt-acres-in-microsoft-excel">Calculating EVT Acres in Microsoft Excel</h2>
<p>Once you‚Äôve processed your attribute table, the first step is calculate how many acres are in each EVT in addition to how many acres are in each BpS. To calculate EVT acres, create a new field called EVT acres, which will be driven by the count field in the CSV. Here‚Äôs how to do it:</p>
<section id="step-by-step-process-1" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process-1">Step-by-Step Process</h3>
<p>üí° <em>Screenshots of the process are included below the written instructions for those who find them useful.</em></p>
<ol type="1">
<li><strong>Create a New Field for EVT Acres</strong>
<ul>
<li>Insert a new column next to the COUNT field and name it EVT Acres.</li>
</ul></li>
<li><strong>Calculate Acres Using the Pixel Count Field</strong>
<ul>
<li>In the first cell of the new ‚ÄúEVT Acres‚Äù column, enter the formula: = [COUNT] * 900 * 0.000247 Replace [COUNT] with the cell reference for the COUNT field in the same row.</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the same calculation we used to calculate BpS Acres in ArcGIS Pro. You can do this in either GIS or your spreadsheet program, whichever you feel more comfortable working with.</p>
</div>
</div>
<ol start="3" type="1">
<li><strong>Copy the Formula Down the Column</strong>
<ul>
<li>Drag the fill handle (a small square at the bottom-right corner of the cell) down the column to apply the formula to all rows.</li>
</ul></li>
</ol>
</section>
<section id="screenshot-for-calculating-evt-acres" class="level3">
<h3 class="anchored" data-anchor-id="screenshot-for-calculating-evt-acres">Screenshot for calculating EVT acres</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/19-evt-acres.png" class="img-fluid figure-img" alt="A Microsoft Excel window showing the spreadsheet. The column for EVT_acres is highlighted with a black box. Another black box surrounds the formula =B2*900*0.0002471"></p>
<figcaption>Calculating EVT acres in Excel.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<p>This process will calculate the EVT acres for each row in your table, allowing you to analyze the data more effectively. From here, you can add another field to calculate the EVT acres burned per year for a comparison with the BpS acres burned per year. You can use the same process for this that you used when calculating BpS acres burned per year.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Right now, we are still assuming that the underlying historical fire return interval applies to existing vegetation. This may not be the case for your landscape. We will provide options for how to adjust this in a later section of this site.</p>
</div>
</div>
</section>
</section>
<section id="creating-a-pivot-table-in-microsoft-excel" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-pivot-table-in-microsoft-excel">Creating a Pivot Table in Microsoft Excel</h2>
<section id="why-use-pivot-tables" class="level3">
<h3 class="anchored" data-anchor-id="why-use-pivot-tables">Why Use Pivot Tables?</h3>
<p>When you combine rasters, the resulting table contains one row per unique combination of values from both rasters. This means that, in this example, the same EVT can be split into multiple rows, each associated with different BPS values. Consequently, you can‚Äôt simply sum the EVT acres directly from the table because the EVT acres are distributed across multiple rows.</p>
<p>Pivot tables allow us to summarize and aggregate data effectively. Here‚Äôs why we need to use pivot tables in this context:</p>
<ol type="1">
<li><strong>Summarizing EVT Acres</strong>
<ul>
<li>Since EVT acres are split across multiple rows, we need to use a pivot table to aggregate the total acres for each EVT. This ensures we get an accurate representation of the total area covered by each vegetation type.</li>
</ul></li>
<li><strong>Calculating Average Fire Return Interval (FRI)</strong>
<ul>
<li>The FRI values are tied to the underlying BpS pixels, meaning different pixels of the same EVT might have different FRI values. Using a pivot table allows us to calculate the average FRI for each EVT by summarizing the FRI values across all relevant rows.</li>
</ul></li>
<li><strong>Summarizing FRI Acres</strong>
<ul>
<li>To understand the total number of acres that should burn annually based on historical fire return intervals, we need to summarize the FRI acres. Pivot tables help us aggregate these values to get a comprehensive view of fire needs for each EVT.</li>
</ul></li>
</ol>
</section>
<section id="step-by-step-process-2" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process-2">Step-by-step process</h3>
<p>üí° <em>Screenshots of the process are included below the written instructions for those who find them useful.</em></p>
<ol type="1">
<li><strong>Insert the pivot table</strong>
<ul>
<li><p>Select the range of cells that contains your data. Make sure to include the column headers.</p></li>
<li><p>Go to the Insert tab on the Excel ribbon.</p></li>
<li><p>Click on PivotTable in the Tables group.</p></li>
<li><p>In the Create PivotTable dialog box, ensure the selected range is correct.</p></li>
<li><p>Choose to place the pivot table in a new worksheet or an existing worksheet. For this tutorial, select ‚ÄúNew Worksheet‚Äù and click OK.</p></li>
</ul></li>
<li><strong>Set Up Your Pivot Table to summarize EVT data</strong>
<ul>
<li><p>A new worksheet will open with a blank pivot table and the PivotTable Fields pane on the right.</p></li>
<li><p>Drag and drop fields into the appropriate areas:</p>
<ul>
<li><p><strong>Rows</strong>: Drag the field you want to categorize your data by. In our case, we want to look at the EVT_NAME field.</p></li>
<li><p><strong>Columns</strong>: Drag the field you want to compare across categories. In our case, we want to look at the value fields we just set, which the pivot table will choose automatically.</p></li>
<li><p><strong>Values</strong>: Drag the fields you want to summarize. In our case, we want to look at FRI_ALLFIR, EVT Acres, and EVT Acres burned per year. By default, Excel will sum these values, but you can change the summary function by clicking on the field in the Values area and selecting ‚ÄúValue Field Settings‚Äù.</p>
<ul>
<li>You will want to change the value fields for the FRI_ALLFIR field, as we want to look at the average FRI, not the summed FRI. To do this, click the drop-down arrow next to the field name, then choose Average from the Summarize value fields by options box.</li>
</ul></li>
</ul></li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is not a weighted average of the FRI, just a straight average. While this number will give you a good starting place, it‚Äôs best practice to use a weighted average ‚Äì taking into account how many acres of a given BPS were in the underlying EVT area ‚Äì to get a more representative fire return interval for the landscape. The process for creating the weighted average FRI using the pivot table is in the following section.</p>
</div>
</div>
</section>
<section id="screenshots-for-creating-the-pivot-table" class="level3">
<h3 class="anchored" data-anchor-id="screenshots-for-creating-the-pivot-table">Screenshots for creating the pivot table</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/20-create-pivot-table.png" class="img-fluid figure-img" alt="A Microsoft Excel window with the PivotTable button highlighted in the ribbon bar. Another window is in front of the data window, showing PivotTable from table or range. The table/Range is set to the full range of data from the worksheet. The radio button next to New Worksheet is checked, choosing to place the PivotTable in a new worksheet."></p>
<figcaption>Select data and create a pivot table.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/21-pivot-table-fields.png" class="img-fluid figure-img" alt="The pivot table window. The PivotTable Fields dialogue box is on the right, showing our columns as Values, Rows as EVT_NAME, Values as Sum of FRI, Sum of EVT Acres, Sum of EVT Acres Burned/Year"></p>
<figcaption>Select the pivot table fields.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/22-pivot-table-value-field.png" class="img-fluid figure-img" alt="The pivot table with the Value Field Settings dialogue box open. Source name is FRI, Summarize values field by is set to Average."></p>
<figcaption>Change the FRI value field to average.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<p>This process will help you summarize your data, making it easier to understand and present your fire needs assessment results.</p>
</section>
</section>
<section id="creating-the-weighted-average-fire-return-interval" class="level2">
<h2 class="anchored" data-anchor-id="creating-the-weighted-average-fire-return-interval">Creating the weighted average fire return interval</h2>
<p>You can use a pivot table to calculate a weighted average, but it requires an extra column in the source data. This may sound complicated, but you simply need to add the new column to the raw data tab, and then create a calculated field in the pivot table.</p>
<section id="step-by-step-process-3" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process-3">Step-by-step process</h3>
<p>üí° <em>Screenshots of the process are included below the written instructions for those who find them useful.</em></p>
<ol type="1">
<li><strong>Create a weight column in the raw data tab</strong>
<ul>
<li>Add a new column to the raw data tab - in the screenshots below it is named Average, but you should call it whatever makes the most sense to you.</li>
</ul></li>
<li><strong>Multiply ‚Äúscore‚Äù by ‚Äúweight‚Äù for each row</strong>
<ul>
<li>In the new column, create a formula that multiplies your ‚Äúscore‚Äù (in this case, FRI) by its ‚Äúweight‚Äù (in this case the Acres column for each row).
<ul>
<li>Thus, the calculation here is Average = FRI*Acres, or H2 = E2*F2 in the example screenshots below.</li>
</ul></li>
</ul></li>
<li><strong>Copy the formula down the column</strong>
<ul>
<li>Drag the fill handle (a small square at the bottom-right corner of the cell) down the column to apply the formula to all rows.</li>
</ul></li>
<li><strong>Add a calculated field to the pivot table</strong>
<ul>
<li><p>With your pivot table selected, go to the PivotTable Analyze tab on the ribbon bar.</p></li>
<li><p>In the Calculations group, click Fields, Items, &amp; Sets, and then select Calculated Field.</p></li>
<li><p>In the dialog box that appears, enter a name for your field. In the screenshots below, it is called Average FRI, but you should name it something that makes sense to you.</p></li>
<li><p>In the formula box, enter the following formula using your new fields:</p>
<ul>
<li>Formula: = Average * EVT_Acres</li>
</ul></li>
<li><p>Click Add, then click OK.</p></li>
<li><p>Drag the new Weighted Average field into the Values area of the PivotTable Fields dialog</p></li>
<li><p>Ensure the new field is set to Sum in the value field settings</p></li>
</ul></li>
</ol>
<section id="screenshots-for-using-the-pivot-table-to-calculate-the-weighted-average" class="level4">
<h4 class="anchored" data-anchor-id="screenshots-for-using-the-pivot-table-to-calculate-the-weighted-average">Screenshots for using the pivot table to calculate the weighted average</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/23-weight-column.png" class="img-fluid figure-img" alt="A Microsoft Excel window with a new column highlighted and a box around the formula bar which shows the formula =E2*F2, corresponding to FRI*EVT Acres"></p>
<figcaption>Create the new column and calculate the weighting.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/24-pivot-table-calculate-field.png" class="img-fluid figure-img" alt="A box highlights the place on the pivot table ribbon bar showing PivotTable Analyze and the Fields, Items, &amp; Sets button. Below that the menu shows Calculate Field highlighted."></p>
<figcaption>Add a calculated field to the pivot table.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/25-pivot-table-calculate-avgfri.png" class="img-fluid figure-img" alt="The Insert Calculated Field window. Name is Weighted Average FRI. the Formula is = Average/'EVT Acres'"></p>
<figcaption>Calculate the field for the weighted average.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/26-pivot-table-value-field-sum.png" class="img-fluid figure-img" alt="The pivot table window. The PivotTable Fields dialogue box is on the right, showing our columns as Values, Rows as EVT_NAME, Values as Sum of FRI, Sum of EVT Acres, Sum of EVT Acres Burned/Year, Sum of Weighted Average FRI. The Value Field Settings is open showing the Sum of Weighted FRI is correctly being calculated as a sum."></p>
<figcaption>Make sure the new field is added as a value and it is being calculated as a sum.</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="creating-a-summary-table-in-microsoft-excel" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-summary-table-in-microsoft-excel">Creating a Summary Table in Microsoft Excel</h2>
<p>Once you have summarized EVT Acres, EVT acres burned per year, and the weighted average FRI for each EVT using a pivot table, you can create a new table in a new worksheet tab to organize this data. This will help you clearly see, for each EVT name, the average historical FRI, the total acres of each EVT on the landscape, and the acres of that EVT burned each year.</p>
<section id="step-by-step-process-4" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process-4">Step-by-Step Process</h3>
<p>üí° <em>Screenshots of the process are included below the written instructions for those who find them useful.</em></p>
<ol type="1">
<li><strong>Summarize Data in Pivot Table</strong>
<ul>
<li>Ensure your pivot table summarizes the following:
<ul>
<li><p><strong>EVT Acres</strong>: Total acres for each EVT.</p></li>
<li><p><strong>EVT Acres Burned per Year</strong>: Total acres burned annually for each EVT.</p></li>
<li><p><strong>Average FRI</strong>: Average historical fire return interval for each EVT.</p></li>
</ul></li>
</ul></li>
<li><strong>Copy Pivot Table Data</strong>
<ul>
<li><p>Select the entire pivot table.</p></li>
<li><p>Right-click and choose ‚ÄúCopy‚Äù or press <code>Ctrl+C</code>.</p></li>
</ul></li>
<li><strong>Create a New Worksheet Tab</strong>
<ul>
<li>Click the ‚Äú+‚Äù icon at the bottom of the Excel window to create a new worksheet tab.</li>
</ul></li>
<li><strong>Paste Pivot Table Data</strong>
<ul>
<li><p>In the new worksheet tab, right-click in the first cell (A1) and choose ‚ÄúPaste Special‚Äù.</p></li>
<li><p>Select ‚ÄúValues‚Äù from the Paste Special options and click ‚ÄúOK‚Äù. This ensures you are pasting only the values, not the pivot table formatting.</p></li>
</ul></li>
<li><strong>Clean Up Table Headers</strong>
<ul>
<li>Review the pasted data and update the table headers to something more meaningful. For example:
<ul>
<li><p><strong>EVT Name</strong></p></li>
<li><p><strong>Average Historical FRI</strong></p></li>
<li><p><strong>Total EVT Acres</strong></p></li>
<li><p><strong>EVT Acres Burned per Year</strong></p></li>
</ul></li>
</ul></li>
<li><strong>Format the Table</strong>
<ul>
<li><p>Adjust column widths and apply any necessary formatting to improve readability.</p></li>
<li><p>You can also add filters to the headers to make it easier to sort and analyze the data.</p></li>
</ul></li>
</ol>
<section id="screenshot-for-creating-the-summary-table" class="level4">
<h4 class="anchored" data-anchor-id="screenshot-for-creating-the-summary-table">Screenshot for creating the summary table</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/27-summary-table.png" class="img-fluid figure-img" alt="The final summary table in Excel. The column names have been cleaned up and data are displayed in more readable formats. Columns are EVT Name, Average FRI (historical), EVT Acres, EVT Acres Burned/Year, %EVT Burned/Year"></p>
<figcaption>Final summary table using data from the pivot table.</figcaption>
</figure>
</div>
<p>This process will help you create a clear and organized summary table, making it easier to understand and present your fire needs assessment results.</p>
<p><strong>Bonus action</strong>: You can also calculate what percent of each EVT should burn per year, by adding a column and then using a formula to divide EVT acres burned per year by total EVT acres.</p>
</section>
</section>
</section>
<section id="saving-the-worksheet-back-to-a-.csv-file" class="level2">
<h2 class="anchored" data-anchor-id="saving-the-worksheet-back-to-a-.csv-file">Saving the worksheet back to a .csv file</h2>
<p>Once you have created your summary table, you will likely want to save it back to a CSV file to ensure compatibility with various programs, including ArcGIS Pro.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>CSV files have very particular formatting needs. You will not be able to save the pivot table to the .csv format, only the content in the summary table worksheet. There is no way to save just one worksheet, so you will first need to copy the summary table to a new Excel workbook and save the .csv file from there.</p>
</div>
</div>
<section id="step-by-step-process-5" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process-5">Step-by-step process</h3>
<ol type="1">
<li><p>Click on File in the Excel ribbon.</p></li>
<li><p>Select Save As.</p></li>
<li><p>Choose the location to save the file.</p></li>
<li><p>In the Save As type dropdown menu, select CSV (comma delimited) (*.csv).</p></li>
<li><p>Enter a meaningful name for the file and click Save.</p></li>
</ol>
</section>
</section>
<section id="bringing-your-csv-file-back-into-arcgis-pro" class="level2">
<h2 class="anchored" data-anchor-id="bringing-your-csv-file-back-into-arcgis-pro">Bringing your CSV file back into ArcGIS Pro</h2>
<p>After saving your worksheet as a CSV file, you can bring the data back into ArcGIS Pro and join it to your EVT raster.</p>
<section id="step-by-step-process-6" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process-6">Step-by-step process</h3>
<p>üí° <em>Screenshots of the process are included below the written instructions for those who find them useful.</em></p>
<ol type="1">
<li><strong>Import the CSV file into ArcGIS Pro</strong>
<ul>
<li><p>Open ArcGIS Pro and navigate to the Catalog pane.</p></li>
<li><p>Right click on Folders and select Add Folder Connection, then navigate to the location of your CSV file.</p></li>
<li><p>Drag the CSV file into your project.</p></li>
</ul></li>
<li><strong>Join the CSV data to the EVT raster</strong>
<ul>
<li>Use the Join Field tool found in the Data Management toolbox under Joins and Relates.
<ul>
<li><p>For the input table, select your masked EVT raster.</p></li>
<li><p>For the input field, select the EVT name field.</p></li>
<li><p>For the join table, select your imported CSV file.</p></li>
<li><p>For the join field, select the EVT name field in the CSV file.</p></li>
<li><p>Transfer the fields for average FRI, acres, and acres burned per year.</p></li>
</ul></li>
</ul></li>
<li><strong>Display the EVT raster</strong> You can now display the EVT raster based on the average FRI or the acres burned per year field. This allows you to visually compare it to the BPS raster and analyze historical vegetation needs based on historical vegetation and fire regimes.</li>
</ol>
<section id="screenshots-for-bringing-your-csv-file-back-into-arcgis-pro" class="level4">
<h4 class="anchored" data-anchor-id="screenshots-for-bringing-your-csv-file-back-into-arcgis-pro">Screenshots for bringing your CSV file back into ArcGIS Pro</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="28-add-csv-arcgis-pro.png" class="img-fluid figure-img" alt="The ArcGIS Pro window. The catalog pane is open on the right side of the screen. A large black arrow points from the catalog pane on the far right to the contents pane on the far left indicating that you should drag the highlighted CSV file across to the catalog pane."></p>
<figcaption>Drag the CSV file into the ArcGIS Pro Contents pane.</figcaption>
</figure>
</div>
<p>&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="29-join-csv-fields.png" class="img-fluid figure-img" alt="The ArcGIS Pro Join Field tool showing the Input Table as EVT_Vegetated, the Input Field as EVT_NAME, the Join Table as the CSV file, the Join Field as EVT, and the Transfer Fields as FRI, Acres, Acres_Year, PCT_Year"></p>
<figcaption>Join the CSV attributes back to the EVT data.</figcaption>
</figure>
</div>
<p>&nbsp;</p>


</section>
</section>
</section>

<section id="still-have-questions-landfire-is-here-to-help." class="level1">
<h1>Still have questions? LANDFIRE is here to help.</h1>
<ul>
<li><p>Ask the <a href="mailto:helpdesk@landfire.gov?subject=landfirehelp">LANDFIRE Helpdesk</a> (email link).</p></li>
<li><p>Search and subscribe to the <a href="https://www.youtube.com/@LANDFIREvideo">LANDFIRE YouTube Channel</a> (see tutorials, Office Hours, quick demonstrations).</p></li>
<li><p><a href="https://tnc.zoom.us/meeting/register/8g82Cz9jTb6H-oRjgL6F9A">Join an Office Hour</a> (monthly meeting with open format Q &amp; A with LANDFIRE experts).</p></li>
<li><p><a href="mailto:landfire@tnc.org?subject=landfirehelp">Schedule a meeting</a> (email link) with TNC‚Äôs LANDFIRE Team.</p></li>
</ul>
</section></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>